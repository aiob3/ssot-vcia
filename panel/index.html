<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SSOT VCIA Panel</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <header class="header">
      <h1>SSOT VCIA Panel</h1>
      <div class="row">
        <code id="status">disconnected</code>
        <button id="refresh">Refresh</button>
      </div>
    </header>

    <main class="container">
      <section class="grid">
        <div class="muted sectionLabel">Feed do Agente → Humano (somente leitura)</div>
        <details open class="card">
          <summary>Project Panel (project-panel.json) — feed do agente</summary>
          <div class="content">
            <pre id="projectPanelRaw" class="pre"></pre>
          </div>
        </details>

        <details class="card">
          <summary>Runbook (runbook.json) — feed técnico (read-only)</summary>
          <div class="content">
            <pre id="runbookRaw" class="pre"></pre>
          </div>
        </details>

        <details open class="card">
          <summary>Decisions Pending (project-panel.json.decisions_pending) — fila de atenção</summary>
          <div class="content">
            <div id="decisionsPending" class="notes"></div>
          </div>
        </details>

        <details class="card">
          <summary>Runbook Steps/Checkpoints — ações do agente</summary>
          <div class="content">
            <div class="row">
              <small class="muted">Visão rápida baseada em runbook.json.steps e runbook.json.checkpoints</small>
            </div>
            <div>
              <h3>Steps</h3>
              <div id="runbookSteps" class="notes"></div>
            </div>
            <div style="margin-top: 10px;">
              <h3>Checkpoints</h3>
              <div id="runbookCheckpoints" class="notes"></div>
            </div>
          </div>
        </details>

        <div class="muted sectionLabel">Incrementos do Operador (HITL) — interação</div>

        <details class="card">
          <summary>Milestones (project-panel.json.milestones) — editar por id</summary>
          <div class="content">
            <form id="milestoneForm" class="form">
              <label>
                id
                <div class="row">
                  <select id="milestoneIdSelect" name="id">
                    <option value="" selected>(selecionar existente)</option>
                  </select>
                  <input id="milestoneIdInput" name="id_input" placeholder="ou digitar id" />
                </div>
              </label>
              <label>
                status
                <input id="milestoneStatus" name="status" placeholder="e.g. pending|in_progress|done" />
              </label>
              <label>
                summary
                <textarea id="milestoneSummary" name="summary" rows="2"></textarea>
              </label>
              <label>
                evidence
                <input id="milestoneEvidence" name="evidence" placeholder="e.g. runbook.json checkpoint ..." />
              </label>
              <label>
                date
                <input id="milestoneDate" name="date" placeholder="YYYY-MM-DD" />
              </label>
              <div class="row">
                <button type="submit">Save milestone</button>
                <small class="muted">Update in-place por id (cria se não existir). Escrita atômica.</small>
              </div>
            </form>

            <div style="margin-top: 10px;">
              <h3>Milestones</h3>
              <div id="milestones" class="notes"></div>
            </div>
          </div>
        </details>

        <details open class="card">
          <summary>Operator Notes (HITL) — incrementos do operador</summary>
          <div class="content">
            <div class="row">
              <button id="toggleAll">Toggle all accordions</button>
              <small class="muted">Refresh/status ficam no topo (header)</small>
            </div>

            <form id="noteForm" class="form" style="margin-top: 10px;">
              <label>
                Priority
                <select name="priority">
                  <option value="P1">P1</option>
                  <option value="P2" selected>P2</option>
                  <option value="P3">P3</option>
                </select>
              </label>
              <label>
                Scope (optional)
                <input name="scope" placeholder="e.g. SSOT_INIT_PARAMS" />
              </label>
              <label>
                Note
                <textarea name="message" rows="4" required placeholder="Operator intervention / attention point"></textarea>
              </label>
              <div class="row">
                <button type="submit">Add note</button>
                <small class="muted">Append-only, idempotente por ID.</small>
              </div>
            </form>

            <div style="margin-top: 10px;">
              <h3>Notes</h3>
              <div id="notes" class="notes"></div>
            </div>
          </div>
        </details>

        <details class="card">
          <summary>Decisions (runbook.json.decisions) — incrementos do operador</summary>
          <div class="content">
            <form id="decisionForm" class="form">
              <label>
                id
                <input name="id" placeholder="DEC-YYYYMMDD-HHMM-..." required />
              </label>
              <label>
                scope
                <input name="scope" value="SSOT_INIT_PARAMS" required />
              </label>
              <label>
                change_summary
                <textarea name="change_summary" rows="2" required></textarea>
              </label>
              <label>
                reason
                <textarea name="reason" rows="2" required></textarea>
              </label>
              <label>
                atomic_unit
                <input name="atomic_unit" required placeholder="Single atomic unit of change" />
              </label>
              <label>
                idempotency_note
                <textarea name="idempotency_note" rows="2" required></textarea>
              </label>
              <label>
                approved_by
                <input name="approved_by" value="operator" required />
              </label>
              <label>
                timestamp (ISO 8601)
                <input name="timestamp" placeholder="2026-01-09T00:00:00Z" required />
              </label>
              <div class="row">
                <button type="submit">Append decision</button>
                <small class="muted">Append-only, idempotente por ID.</small>
              </div>
            </form>
            <div id="decisions" class="notes"></div>
          </div>
        </details>
      </section>
    </main>

    <script src="./app.js"></script>
  </body>
</html>
